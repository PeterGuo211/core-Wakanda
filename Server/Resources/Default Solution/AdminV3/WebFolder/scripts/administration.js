/*Wakanda Software (the "Software") and the corresponding source code remainthe exclusive property of 4D and/or its licensors and are protected by nationaland/or international legislations.This file is part of the source code of the Software provided under the relevantWakanda License Agreement available on http://www.wakanda.org/license whose complianceconstitutes a prerequisite to any use of this file and more generally of theSoftware and the corresponding source code.*/function firstToUpper(str) {    return str.replace(/^(.)(.*)/, function(str, p1, p2) {        return p1.toUpperCase() + p2;    })}if (typeof WAF === 'undefined') {    WAF = {};  //object vide}WAF.serverAdmin = {  // Sous objet    status:		null, // attribut    rpc:		null,    loader:		{        show:	function() {  //attribut (methode)            $('#test').show();        },        hide:	function() {            $('#test').hide();        }    },    dialog:		{        show:	function() {            $('#administration-workspace-left-content').show();        },        hide:	function() {            $('#administration-workspace-left-content').hide();        }    },    console:	{ //sous sous objet        timer:			null,        opened:			false,        node:			$('#wafConsole'),        getServerLog:	function() {            try {                var result = getLogMessages();                                this.log(result.messages, true);            } catch(E) {                this.log('<b>getServerLog failed :</b> ' + E);            };        },        log:			function(el, open) {            var html = '';			            if($.isArray(el) && el.length) {                html = el.join('<br />') + '<br />';            } else if ($.isPlainObject(el) && el.message && (el.message !== '')) {                html = el.message.bold() + ' : ' + el.description + '<br />';            } else if (el.toString() !== '') {                html = el.toString() + '<br />';            }			            if(html !== '') {                if(open) this.open();                $('#wafConsole .content').append(html).scrollTop($('#wafConsole .content').height() + 100);            }        },        open:			function() {            if(!this.opened) {                this.node                .animate({                    height: '20%'                })                /*					.animate(						{height: '20%'},						500,						function() {							console.log(this)						}					)*/                .addClass('visible');                this.opened = true;            }        },        close:			function() {            if(this.opened) {                this.node                .animate({                    height: 27                })                .removeClass('visible');                this.opened	= false;            }        },        toggle:			function() {            (this.opened) ? this.close() : this.open();        }    },    solution:	{        openTimer:	null,        current:	null,        open:		null,        recent:		{            name:	'',            path:	''        },        openRecent:	null,        get:		null,        close:		null,                loadBy:		function(type) {            var n = 0;            this.openTimer = setInterval(function() {  //this referebce d'objt loadBy'                if(n < 10) {                    try {                        tmpSolution = WAF.serverAdmin.solution.get();                        if(typeof(tmpSolution) === 'object' && typeof(tmpSolution['name']) !== 'undefined') {                            WAF.serverAdmin.solution.current	= tmpSolution;                            WAF.serverAdmin.solutions.recent	= WAF.serverAdmin.solutions.getRecent();                            WAF.serverAdmin.solutions.setRecent();                            WAF.serverAdmin.console.getServerLog();                            WAF.serverAdmin.solution.build(WAF.serverAdmin.solution.current);							                            clearInterval(WAF.serverAdmin.solution.openTimer);							                            WAF.serverAdmin.loader.hide();                        }                    } catch(E) {                    //WAF.serverAdmin.console.log(E);                    }                } else {                    clearInterval(WAF.serverAdmin.solution.openTimer);                    switch(type) {                        case 'name':                            WAF.serverAdmin.solution.openRecent(WAF.serverAdmin.solution.recent.name);                            break;                        case 'path':                            WAF.serverAdmin.solution.open(WAF.serverAdmin.solution.recent.path);                            break;                    }                }                n++;            }, 3000);                 },        build:		function(solution) {            // Setting solution's name            $('#solution-identity h1').text(solution.name);			            // Resetting viewport            $('#viewport').empty();			            // Building applications						            WAF.serverAdmin.loader.hide();        }    },    solutions:	{        recent:	null,        getRecent:	null,        setRecent:	function() {                       $('.administration-formular').empty();            $('#accordion').empty();                        $(this.recent).each(function(i, name ) {                                                                //------------------accordion                                         var element = '<div class="administration-header"><a href="#" id="solution-open-recent">' + name + '</a></div>';                                var tab = '<TABLE  id="myTable" class="ui-jqgrid-htable">'+                           '<TR class="ui-jqgrid-hbox"><th></th><Th role="columnheader" class="ui-jqgrid-sortable">Project</Th><Th role="columnheader" class="ui-jqgrid-sortable">IP</Th><Th role="columnheader" class="ui-jqgrid-sortable">Port</Th><Th role="columnheader" class="ui-jqgrid-sortable">Hostname</Th><Th role="columnheader" class="ui-jqgrid-sortable">Data</Th><Th role="columnheader" class="ui-jqgrid-sortable">Model</Th></TR>'+                           '</TABLE>';                                                                                                                          if (i==0){                    element +=  '<div class="Content">' + tab + '</div>';                        }else{                            element +=  '<div class="Content"></div>';                        }                                                                $('#accordion').append(element);                                                                                  });               //---------------------------                              var application ;                                       for (var j=0;j<WAF.serverAdmin.solution.current.applications.length-1;j++) {                                                             application = WAF.serverAdmin.solution.current.applications[j];                                                                                           //--------------table of projects----------------------                                          $('#myTable').append('<TR><td><INPUT type="checkbox" name="choix'+j+'" value="'+j+'"></td><TD>'+application.name+                           '</TD><TD>'+application.http.ip+                           '</TD><TD>'+application.http.port+                           '</TD><TD>'+application.http.hostName+                           '</TD><TD title="'+application.waData+'" >./data/'+application.name+'</TD><TD title = "'+application.waModel+'"  >./'+application.name+'</TD></TR>');                                                                                                                                                                                        //-------------right -----------------//                                                                     var  App = JSON.stringify(application);                                                         Url =  '/Files';                                                                                                        $.ajax({                                    type: 'POST',                                    url         :   Url,                                    data        :   App,                                    async  : false,                                    contentType :   "text/plain",                                    success:function(data){                                        var  tables=JSON.parse(data);                                        var txt="";                                         var regName=new RegExp("[ ]+", "g");                                          var regDate=new RegExp("[T]+", "g");                                        for (var i=0;i<tables.files.length;i++){                                                                                     var  name = tables.files[i].name.split(regName)                                          var  date = tables.files[i].date.split(regDate)                                                                                      txt+=   '<tr class = "trcol"><td><a href="/Readfile?file='+tables.files[i].name+'" target="_blank">'+name[0]+'</a></td><td style="width:200px;">'+date[0]+' '+date[1].substring(0, 5)+'</td><td class="tdcol"><button id="remove"  class="studio-icon-remove" value="'+tables.files[i].name+'"></button></td></tr>';                                                                                     }                                                                                                                        txt = '<div class="portlet-content"><table   id="administration-user-general">'+txt+'</table></div>';                                                                                                                                                                     $("#administration-workspace-top-content .administration-content .administration-formular").append('<div class="portlet">'+						'<div class="portlet-header">'+application.name+'</div>'+txt+'</div>');                                                                            },                                        error :function(err) {                                                                               }                                       });                                                                                                         }                                                                     Formulaire();                                                                              }    },    init:		function() {        this.rpc = new WAF.classes.Rpc();    	        // Mapping of interfacing functions        this.rpc.getInterfaces();    	        this.solution.close			= closeSolution;        this.solution.get			= getSolution;        this.solution.open			= openSolution;        this.solution.openRecent	= openRecentSolution;           	        this.solutions.getRecent	= getRecentSolutions;    	    	        // Building default solution        this.solution.current		= this.solution.get();        if(typeof(this.solution.current) === 'undefined') this.console.log('Unable to retrieve a solution.', true);    	setSpliter();        this.solutions.recent		= this.solutions.getRecent();        this.solutions.setRecent();    	//        this.console.getServerLog();            	        this.solution.build(this.solution.current);                    }};( function(){        //specific mod for tests purpose in the navigator (see web toolbar)          WAF.serverAdmin.init();            $("#administration-header").show();    $("#administration-toolbar").show();    $("#administration-workspace").css("top", "60px");                  // EVENT DELEGATION *******************************************************	$(document.body)           .delegate('.toolbar-element.toolbar-button.administration-verify', 'click', function(event) {        if($('input:checked').length>0){             var name_app,Url;                                               $('input[type=checkbox]:checked').each(function(key,val){                                                                                  name_app = $($(val).parent().parent().children()[1]).html();                                                          var App = {                                 name : name_app                                                              };							                                                       App = JSON.stringify(App);                             Url =  '/Verify';                             $.ajax({                                    type: 'POST',                                    url         :   Url,                                    data        :   App,                                    contentType :   "text/plain",                                    async  : false,                                    success:function(data){                                         var  tables=JSON.parse(data);                                         var name_app =   JSON.parse(App); 										 var txt='' ;										 txt = '<p style="font-family:Arial,sans-serif; font-size:18px; color:green" > Name of project : ' + name_app.name +' /Verify</p>';                                         if (tables.length> 0 ){                                                             for (var i=0;i<tables.length;i++){															                                                       if (tables[i].ErrorText) {                                                                                                       txt += '<p style="font-family:Arial,sans-serif; font-size:18px; color:Red">Error : ' + tables[i].ErrorText + ' ,ProblemType :' + tables[i].ProblemType+                                                            ', ErrorNumber : ' + tables[i].ErrorNumber +' ,ProblemTypeText :' + tables[i].ProblemTypeText + ' ,ErrorLevel :' + tables[i].ErrorLevel;															if (tables[i].RecordNum){															     txt += ' ,RecordNum :' + tables[i].RecordNum + '</p>' ;															}else{															txt +='</p>';																														}																																																								                                                        }else{                                                           txt +='<p style="font-family:Arial,sans-serif; font-size:18px; color:blue">' + tables[i]+ '</p>' ;                                                           }                                                            }                                                                                                     } else {                                                                                           txt += '<p style="font-family:Arial,sans-serif; font-size:18px; color:blue" > no errors found </p>';                                                                                      }                                        $('#wafConsole .content').prepend(txt);                                         WAF.serverAdmin.console.open();                                         WAF.serverAdmin.solutions.setRecent();                                        },                                        error :function(err) {                                        }                                       });                                                                             							                                        });              }else{                              alert("Please choose a project")           }                                       })       .delegate('.toolbar-element.toolbar-button.administration-repair', 'click', function(event) {                      if($('input:checked').length>0){                            var name_app,Url;                                               $('input[type=checkbox]:checked').each(function(key,val){                                                                                   name_app = $($(val).parent().parent().children()[1]).html();                                                          var App = {                                 name : name_app                                                              };							                                                       App = JSON.stringify(App);                             Url =  '/Repair';                             $.ajax({                                    type: 'POST',                                    url         :   Url,                                    data        :   App,                                    contentType :   "text/plain",                                    async  : false,                                    success:function(data){                                         var  tables=JSON.parse(data);                                         var name_app =   JSON.parse(App); 										 var txt='' ;										 txt = '<p style="font-family:Arial,sans-serif; font-size:18px; color:green" > Name of project : ' + name_app.name +' /Repair</p>';                                         if (tables.length> 0 ){                                                             for (var i=0;i<tables.length;i++){															                                                       if (tables[i].ErrorText) {                                                                                                       txt += '<p style="font-family:Arial,sans-serif; font-size:18px; color:Red">Error : ' + tables[i].ErrorText + ' ,ProblemType :' + tables[i].ProblemType+                                                            ', ErrorNumber : ' + tables[i].ErrorNumber +' ,ProblemTypeText :' + tables[i].ProblemTypeText + ' ,ErrorLevel :' + tables[i].ErrorLevel;															if (tables[i].RecordNum){															     txt += ' ,RecordNum :' + tables[i].RecordNum + '</p>' ;															}else{															txt +='</p>';																														}																																																								                                                        }else{                                                           txt +='<p style="font-family:Arial,sans-serif; font-size:18px; color:blue">' + tables[i]+ '</p>' ;                                                           }                                                            }                                                                                                     } else {                                                                                           txt += '<p style="font-family:Arial,sans-serif; font-size:18px; color:blue" > no errors found </p>';                                                                                      }                                        $('#wafConsole .content').prepend(txt);                                        WAF.serverAdmin.console.open();                                         WAF.serverAdmin.solutions.setRecent();                                        },                                        error :function(err) {                                        }                                       });                                                 											                                        });                                }else{                              alert("Please choose a project")           }                                       })       .delegate('.toolbar-element.toolbar-button.administration-compact', 'click', function(event) {                              if($('input:checked').length>0){                        var name_app,Url;                                               $('input[type=checkbox]:checked').each(function(key,val){                                                                                   name_app = $($(val).parent().parent().children()[1]).html();                                                          var App = {                                 name : name_app                                                              };							                                                       App = JSON.stringify(App);                             Url =  '/Compact';                             $.ajax({                                    type: 'POST',                                    url         :   Url,                                    data        :   App,                                    contentType :   "text/plain",                                    async  : false,                                    success:function(data){                                         var  tables=JSON.parse(data);                                         var name_app =   JSON.parse(App); 										 var txt='' ;										 txt = '<p style="font-family:Arial,sans-serif; font-size:18px; color:green" > Name of project : ' + name_app.name +' /Compact</p>';                                         if (tables.length> 0 ){                                                             for (var i=0;i<tables.length;i++){															                                                       if (tables[i].ErrorText) {                                                                                                       txt += '<p style="font-family:Arial,sans-serif; font-size:18px; color:Red">Error : ' + tables[i].ErrorText + ' ,ProblemType :' + tables[i].ProblemType+                                                            ', ErrorNumber : ' + tables[i].ErrorNumber +' ,ProblemTypeText :' + tables[i].ProblemTypeText + ' ,ErrorLevel :' + tables[i].ErrorLevel;															if (tables[i].RecordNum){															     txt += ' ,RecordNum :' + tables[i].RecordNum + '</p>' ;															}else{															txt +='</p>';																														}																																																								                                                        }else{                                                           txt +='<p style="font-family:Arial,sans-serif; font-size:18px; color:blue">' + tables[i]+ '</p>' ;                                                           }                                                            }                                                                                                     } else {                                                                                           txt += '<p style="font-family:Arial,sans-serif; font-size:18px; color:blue" > no errors found </p>';                                                                                      }                                        $('#wafConsole .content').prepend(txt);                                        WAF.serverAdmin.console.open();                                         WAF.serverAdmin.solutions.setRecent();                                        },                                        error :function(err) {                                        }                                       });                                                 											                                        });                                   }else{                              alert("Please choose a project")           }                   })              .delegate('#remove', 'click', function(event) {                		                var file = {                                 name : $(this).val()                                                              };                                                     file = JSON.stringify(file);                              Url =  '/DeleteFile';                             $.ajax({                                    type: 'POST',                                    url         :   Url,                                    data        :   file,                                    async  : false,                                    contentType :   "text/plain",                                    success:function(data){                                                                          },                                    error :function(err) {                                        }                                       });                                                                   WAF.serverAdmin.solutions.setRecent();                                                          	})                     // wafConsole	.delegate('#wafConsole .title', 'click', function(event) {                		WAF.serverAdmin.console.toggle();	})} )();